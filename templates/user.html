<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>بطاقة العضو - نادي مديسيسة</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Cairo&display=swap');

body {
    font-family:'Cairo',sans-serif;
    background:#faf3e0;
    margin:0;
    padding:20px;
    display:flex;
    justify-content:center;
    align-items:center;
    flex-direction:column;
    min-height:100vh;
}

/* الحاوية */
.card-container {
    max-width:600px;
    width:100%;
    margin-bottom:20px;
}

/* البطاقة */
.user-card {
    position:relative;
    background:#800000;
    border-radius:20px;
    padding:20px;
    display:flex;
    overflow:hidden;
    min-height:250px;
    box-shadow:0 15px 30px rgba(0,0,0,0.3);
    animation: pulse 3s infinite;
    transition: transform 0.3s;
}

.user-card:hover {
    transform: scale(1.02);
}

@keyframes pulse {
    0%,100% {transform: scale(1);}
    50% {transform: scale(1.005);}
}

/* نقوش نوبية على العنابي من الجهة اليسرى */
.user-card::after {
    content:"";
    position:absolute;
    top:0;
    left:0;
    width:40%;
    height:100%;
    background:url('static/images/nubian_pattern.png') repeat;
    opacity:0.05;
    z-index:0;
}

/* شعار شفاف في المنتصف */
.user-card::before {
    content:"";
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%, -50%);
    width:200px;
    height:200px;
    background:url('static/images/logo.png') no-repeat center/contain;
    opacity:0.1;
    z-index:1;
}

/* شعار أعلى البطاقة */
.logo-top {
    position:absolute;
    top:20px;
    right:20px;
    width:80px;
    height:80px;
    background:url('static/images/logo.png') no-repeat center/contain;
    z-index:2;
}

/* قسم صورة العضو الرقمي (يسار البطاقة) */
.profile-strip {
    position:relative;
    flex-shrink:0;
    width:120px;
    height:100%;
    background:linear-gradient(90deg, #c0c0c0 0%, #e0e0e0 100%);
    border-radius:10px;
    margin-left:20px;
    display:flex;
    justify-content:center;
    align-items:center;
    flex-direction:column;
    padding:10px;
    z-index:2;
    overflow:hidden;
}

.profile-strip img {
    width:80px;
    height:100px;
    object-fit:cover;
    filter: grayscale(100%) brightness(0.9);
    border:2px solid #fff;
    border-radius:5px;
    margin-bottom:10px;
}

/* أيقونة شريط الفيديو */
.profile-strip::after {
    content:"\1F4FD"; /* أيقونة كاميرا فيديو */
    font-size:1.5em;
    color:#fff;
    position:absolute;
    bottom:10px;
}

/* بيانات المستخدم */
.user-info {
    color:white;
    text-align:right;
    z-index:2;
    flex:1;
    display:flex;
    flex-direction:column;
    justify-content:center;
}

.user-info h2 {
    margin:0 0 10px 0;
    font-size:1.4em;
}

.user-info p {
    margin:3px 0;
    font-size:1em;
}

/* QR كود */
.qr-box {
    margin-top:10px;
    text-align:right;
}

.qr-box img {
    width:100px;
    border:2px solid gold;
    border-radius:8px;
}

/* مميزات البطاقة */
.card-features {
    max-width:600px;
    background:white;
    border-radius:15px;
    padding:15px;
    box-shadow:0 10px 25px rgba(0,0,0,0.25);
    margin-top:15px;
}

.card-features h3 {
    margin:0 0 10px 0;
    color:#800000;
}

.card-features ul {
    margin:0;
    padding-left:20px;
}

.card-features li {
    margin-bottom:5px;
}

/* زر تحميل PDF */
.download-btn {
    display:block;
    margin:15px auto 0;
    padding:10px 20px;
    background:#800000;
    color:white;
    border:none;
    border-radius:8px;
    cursor:pointer;
    text-align:center;
    font-size:1em;
    text-decoration:none;
}

/* متجاوب */
@media (max-width: 700px) {
    .user-card { flex-direction: column; align-items:center; min-height: auto; }
    .profile-strip { width:80%; margin-left:0; margin-bottom:15px; }
    .user-info { text-align:center; }
    .qr-box { text-align:center; }
}
</style>
</head>
<body>

<div class="card-container">
    <div class="user-card">
        <!-- شعار أعلى البطاقة -->
        <div class="logo-top"></div>

        <!-- شريط صورة العضو الرقمي -->
        <div class="profile-strip">
            <img src="{{ user.photo_url }}" alt="صورة العضو">
        </div>

        <!-- بيانات المستخدم -->
        <div class="user-info">
            <h2>{{ user.full_name }}</h2>
            <p><strong>اسم المستخدم:</strong> {{ user.username }}</p>
            <p><strong>رقم العضوية:</strong> {{ user.card_number }}</p>
            <p><strong>رقم الهاتف:</strong> {{ user.phone or 'غير محدد' }}</p>
            <p><strong>الرقم الوطني:</strong> {{ user.national_id or 'غير محدد' }}</p>
            <p><strong>تاريخ التسجيل:</strong> {{ registration_date }}</p>
            <p><strong>صلاحية البطاقة:</strong> {{ expiry_date }}</p>

            <div class="qr-box">
                <p>امسح الباركود لعرض البطاقة</p>
                <img src="data:image/png;base64,{{ qr_code }}" alt="QR Code">
            </div>
        </div>
    </div>
</div>

<!-- مميزات البطاقة -->
<div class="card-features" id="features-section">
    <h3>مميزات البطاقة لحاملها:</h3>
    <ul>
        <li>الدخول المجاني إلى أنشطة النادي</li>
        <li>الحصول على خصومات على الدورات والفعاليات</li>
        <li>إمكانية المشاركة في البطولات والمسابقات</li>
        <li>تحديث مستمر للعضوية إلكترونيًا</li>
    </ul>
    <a class="download-btn" href="#" onclick="downloadPDF()">تحميل البطاقة كـ PDF</a>
</div>

<!-- jsPDF + html2canvas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
function downloadPDF() {
    const { jsPDF } = window.jspdf;
    var doc = new jsPDF({
        orientation: "landscape",
        unit: "px",
        format: [600, 600]
    });

    var card = document.querySelector('.user-card');
    var features = document.getElementById('features-section');

    Promise.all([
        html2canvas(card),
        html2canvas(features)
    ]).then(([cardCanvas, featuresCanvas]) => {
        var cardImg = cardCanvas.toDataURL('image/png');
        var featuresImg = featuresCanvas.toDataURL('image/png');

        doc.addImage(cardImg, 'PNG', 0, 0, 600, 300);
        doc.addImage(featuresImg, 'PNG', 0, 310, 600, 290);
        doc.save('بطاقة_العضو.pdf');
    });
}
</script>

</body>
</html>
