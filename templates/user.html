<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>بطاقة العضو - نادي مديسيسة</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Cairo&display=swap');

body{
    font-family:'Cairo',sans-serif;
    background:#f2f0ec;
    margin:0;
    padding:20px;
    display:flex;
    flex-direction:column;
    align-items:center;
}

/* الحاوية */
.card-container{
    max-width:600px;
    width:100%;
}

/* البطاقة */
.user-card{
    position:relative;
    background:linear-gradient(145deg,#7a0000,#a00000);
    border-radius:20px;
    padding:20px;
    display:flex;
    gap:15px;
    box-shadow:0 15px 30px rgba(0,0,0,.4);
    overflow:hidden;
}

/* زخرفة خلفية */
.user-card::after{
    content:"";
    position:absolute;
    inset:0;
    background:url('static/images/nubian_pattern.png') repeat;
    opacity:.05;
    z-index:0;
}

/* شعار مائي كبير */
.user-card::before{
    content:"";
    position:absolute;
    left:50%;
    top:50%;
    transform:translate(-50%,-50%);
    width:220px;
    height:220px;
    background:url('static/images/logo.png') no-repeat center/contain;
    opacity:.08;
}

/* شعار علوي */
.logo-top{
    position:absolute;
    top:15px;
    right:15px;
    width:90px;
    height:90px;
    background:url('static/images/logo.png') no-repeat center/contain;
    z-index:3;
}

/* عمود الصورة */
.profile-column{
    display:flex;
    flex-direction:column;
    align-items:center;
    z-index:3;
}

/* صورة المستخدم */
.profile-box{
    width:120px;
    height:120px;
    border:3px solid gold;
    border-radius:15px;
    overflow:hidden;
    box-shadow:0 5px 15px rgba(0,0,0,.4);
}

.profile-box img{
    width:100%;
    height:100%;
    object-fit:cover;
}

/* شعار تحت الصورة */
.small-logo{
    width:50px;
    height:50px;
    margin:8px 0;
    background:url('static/images/logo.png') no-repeat center/contain;
}

/* QR */
.qr-box img{
    width:95px;
    border:2px solid gold;
    border-radius:8px;
}

/* البيانات */
.user-info{
    color:#fff;
    flex:1;
    z-index:3;
}

.user-info h2{margin:0 0 8px}
.user-info p{margin:3px 0}

/* العلامة المائية الجانبية (عكس الصورة) */
.profile-strip{
    position:absolute;
    left:0;
    top:20px;
    width:60px;
    height:calc(100% - 40px);
    background:linear-gradient(90deg,#e0e0e0,#f5f5f5);
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:6px 0;
    z-index:1;
}

.profile-strip img{
    width:38px;
    height:38px;
    object-fit:cover;
    filter:grayscale(100%) opacity(25%);
    margin:6px 0;
}

/* مميزات البطاقة */
.card-features{
    max-width:600px;
    width:100%;
    background:#fff;
    border-radius:18px;
    margin-top:15px;
    box-shadow:0 10px 25px rgba(0,0,0,.25);
    overflow:hidden;
}

.card-features h3{
    margin:0;
    padding:12px;
    background:#7a0000;
    color:#fff;
    text-align:center;
}

.card-features ul{
    padding:15px 25px;
    margin:0;
}

.card-features li{
    margin-bottom:6px;
}

/* زر التحميل */
.download-btn{
    margin-top:15px;
    padding:12px 25px;
    background:#7a0000;
    color:#fff;
    border-radius:10px;
    text-decoration:none;
    display:inline-block;
    box-shadow:0 5px 15px rgba(0,0,0,.3);
    cursor:pointer;
}

/* موبايل */
@media(max-width:650px){
    .user-card{
        flex-direction:column;
        align-items:center;
        text-align:center;
    }
    .profile-strip{display:none}
}
</style>
</head>

<body>

<div class="card-container" id="cardArea">
    <div class="user-card">

        <div class="logo-top"></div>

        <div class="profile-column">
            <div class="profile-box">
                <img src="{{ user.photo_url }}">
            </div>
            <div class="small-logo"></div>
            <div class="qr-box">
                <img src="data:image/png;base64,{{ qr_code }}">
            </div>
        </div>

        <div class="user-info">
            <h2>{{ user.full_name }}</h2>
            <p>اسم المستخدم: {{ user.username }}</p>
            <p>رقم العضوية: {{ user.card_number }}</p>
            <p>الهاتف: {{ user.phone or 'غير محدد' }}</p>
            <p>الرقم الوطني: {{ user.national_id }}</p>
            <p>تاريخ التسجيل: {{ registration_date }}</p>
            <p>الصلاحية: {{ expiry_date }}</p>
        </div>

        <div class="profile-strip">
            {% for i in range(5) %}
            <img src="{{ user.photo_url }}">
            {% endfor %}
        </div>

    </div>
</div>

<div class="card-features">
    <h3>مميزات البطاقة</h3>
    <ul>
        <li>الدخول المجاني للأنشطة</li>
        <li>خصومات على الدورات</li>
        <li>المشاركة في البطولات</li>
        <li>تجديد إلكتروني</li>
    </ul>
</div>

<a class="download-btn" onclick="downloadPDF()">تحميل البطاقة PDF</a>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
async function downloadPDF(){
    const { jsPDF } = window.jspdf;
    const card = document.getElementById('cardArea');
    const rect = card.getBoundingClientRect();

    const canvas = await html2canvas(card,{
        scale:3,
        useCORS:true
    });

    const imgData = canvas.toDataURL('image/png',1.0);

    const pdf = new jsPDF({
        orientation: rect.width > rect.height ? 'landscape' : 'portrait',
        unit:'px',
        format:[rect.width, rect.height]
    });

    pdf.addImage(imgData,'PNG',0,0,rect.width,rect.height);
    pdf.save('بطاقة_العضو.pdf');
}
</script>

</body>
</html>
