<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø´Ù‡Ø§Ø¯Ø© Ø³ÙƒÙ†</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600&display=swap" rel="stylesheet">

<style>
*{
    filter:none !important;
    backdrop-filter:none !important;
    transform:none !important;
}

body{
    font-family:'Cairo',sans-serif;
    background:#eee;
    padding:20px;
    display:flex;
    flex-direction:column;
    align-items:center;
}

/* ===== ØªÙ†Ø¨ÙŠÙ‡ ÙÙˆÙ‚ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© ===== */
#alert-msg {
    max-width:1000px;
    width:100%;
    background:#ffeb3b;
    color:#000;
    font-weight:bold;
    text-align:center;
    padding:10px;
    margin-bottom:15px;
    border-radius:8px;
    font-size:16px;
    box-sizing:border-box;
}

/* ===== Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© ===== */
#certificate{
    width:1000px;
    max-width:100%;
    height:auto;
    aspect-ratio:1000/560;
    position:relative;
    overflow:hidden;
    background:#fff;
    box-sizing:border-box;
}

/* ===== Ø§Ù„Ø®Ù„ÙÙŠØ© ===== */
#certificate img.bg{
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
    object-fit:cover;
    pointer-events:none;
}

/* ===== Ø§Ù„Ø§Ø³Ù… ===== */
.name{
    position:absolute;
    top:206px;
    left:0;
    right:0;
    text-align:center;
    font-size:38px;
    font-weight:600;
    color:#1b7f6a;
}

/* ===== Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ·Ù†ÙŠ ===== */
.national{
    position:absolute;
    top:296px;
    right:520px;
    font-size:22px;
    font-weight:600;
    color:#1b7f6a;
    direction:ltr;
    font-family:Arial, sans-serif;
}

/* ===== Ø§Ù„ØªØ§Ø±ÙŠØ® ===== */
.date{
    position:absolute;
    bottom:320px;
    right:530px;
    font-size:18px;
    font-weight:600;
    color:#1b7f6a;
    direction:ltr;
    font-family:Arial, sans-serif;
}

/* ===== Ø²Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ ===== */
button{
    margin-top:20px;
    padding:12px 25px;
    border:none;
    border-radius:10px;
    background:#1b7f6a;
    color:#fff;
    cursor:pointer;
    font-size:16px;
}

/* ===== Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© ===== */
@media(max-width:768px){
    .name{
        font-size:28px;
        top:150px;
    }
    .national{
        font-size:18px;
        top:220px;
        right:50px;
    }
    .date{
        font-size:16px;
        bottom:50px;
        right:20px;
    }
    #certificate{
        height:auto;
        aspect-ratio:1000/560;
    }
    #alert-msg{
        font-size:14px;
    }
}
</style>
</head>

<body>

<div id="alert-msg">
ğŸ”” Ø§Ù„ØªØ­Ø°ÙŠØ±: Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ù„Ø§ ØªØ¹ØªÙ…Ø¯ Ø±Ø³Ù…ÙŠØ§Ù‹ Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ ØªÙˆÙ‚ÙŠØ¹ Ø±Ø¦ÙŠØ³ Ø§Ù„Ù„Ø¬Ù†Ø© Ø¹Ù„ÙŠÙ‡Ø§. ÙŠØ±Ø¬Ù‰ ØªÙ†Ø²ÙŠÙ„Ù‡Ø§ ÙˆØ·Ø¨Ø§Ø¹ØªÙ‡Ø§ Ù…Ù„ÙˆÙ†Ø© ÙˆØ¥Ø­Ø¶Ø§Ø±Ù‡Ø§ Ù„Ø±Ø¦ÙŠØ³ Ø§Ù„Ù„Ø¬Ù†Ø© Ù„Ø§Ø¹ØªÙ…Ø§Ø¯Ù‡Ø§.
</div>

<div id="certificate">
    <img src="/static/images/certificate_bg.jpg" class="bg">
    <div class="name" id="name">{{ user.full_name }}</div>
    <div class="national" id="nid">{{ user.national_id }}</div>
    <div class="date" id="date">{{ today }}</div>
</div>

<button onclick="downloadPDF()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© PDF</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
async function downloadPDF(){
    const { jsPDF } = window.jspdf;

    const cert = document.getElementById("certificate");
    const name = document.getElementById("name");
    const nid  = document.getElementById("nid");
    const date = document.getElementById("date");

    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ·Ù†ÙŠ ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® Ø£Ø«Ù†Ø§Ø¡ Ø£Ø®Ø° Ø§Ù„ØµÙˆØ±Ø© Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªÙƒØ±Ø§Ø±
    name.style.visibility = "hidden";
    nid.style.visibility  = "hidden";
    date.style.visibility = "hidden";

    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
    const alertMsg = document.getElementById("alert-msg");
    alertMsg.style.display = "none";

    // Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø¨Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ù‹Ø§
    const canvas = await html2canvas(cert, {
        scale:4,
        useCORS:true,
        backgroundColor:"#fff"
    });

    const imgData = canvas.toDataURL("image/png", 1.0);

    const pdf = new jsPDF({
        orientation:"landscape",
        unit:"px",
        format:[1000,560]
    });

    // Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©
    pdf.addImage(imgData, "PNG", 0, 0, 1000, 560);

    // ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù†ØµÙˆØµ Vector Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·
    pdf.setTextColor(27,127,106);
    pdf.setFont("Helvetica","bold");

    pdf.setFontSize(38);
    pdf.text(name.innerText, 500, 245, { align:"center" });

    pdf.setFontSize(22);
    pdf.text(nid.innerText, 540, 325);

    pdf.setFontSize(18);
    // ØªØ­Ø±ÙŠÙƒ Ø§Ù„ØªØ§Ø±ÙŠØ® 400px Ù„Ù„Ø£Ø³ÙÙ„ Ùˆ100px Ù„Ù„Ø´Ù…Ø§Ù„
    pdf.text(date.innerText, 830, 640); // 930 - 100 = 830 Ù„ØªØ­Ø±ÙŠÙƒ 100px Ù„Ù„Ø´Ù…Ø§Ù„

    // ØªØ­Ù…ÙŠÙ„ PDF
    pdf.save("Ø´Ù‡Ø§Ø¯Ø©_Ø³ÙƒÙ†_Ù…Ø¯ÙŠØ³ÙŠØ³Ø©.pdf");

    // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ·Ù†ÙŠ ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ØªÙ†Ø¨ÙŠÙ‡
    name.style.visibility = "visible";
    nid.style.visibility  = "visible";
    date.style.visibility = "visible";
    alertMsg.style.display = "block";
}
</script>

</body>
</html>
